project_name: version

before:
  hooks:
    - go mod tidy

builds:
  - id: version
    main: ./cmd/version
    binary: version
    env:
      - CGO_ENABLED=0
    goos: [linux, windows, darwin]
    goarch: [amd64, arm64]
    ldflags:
      - -s -w
      - -X github.com/AlexBurnes/version-go/internal/buildinfo.Version={{ .Version }}
      - -X github.com/AlexBurnes/version-go/internal/buildinfo.Commit={{ .FullCommit }}
      - -X github.com/AlexBurnes/version-go/internal/buildinfo.Date={{ .Date }}
      - -X github.com/AlexBurnes/version-go/internal/buildinfo.Dirty={{ .IsGitDirty }}

archives:
  - id: default
    builds: [version]
    format_overrides:
      - goos: windows
        format: zip
    name_template: "{{ .ProjectName }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}"
    files:
      - LICENSE
      - README.md
      - "packaging/linux/install.sh"

checksum:
  name_template: "checksums.txt"

release:
  prerelease: auto
  draft: false

scoop:
  bucket:
    owner: AlexBurnes
    name: scoop-bucket
    branch: main
  homepage: "https://github.com/AlexBurnes/version-go"
  description: "git describe-like CLI"
  license: "MIT"
  name: version
  commit_msg_template: "chore(scoop): update version to {{ .Tag }}"
  url_template: "https://github.com/AlexBurnes/version-go/releases/download/{{ .Tag }}/{{ .ArtifactName }}"
